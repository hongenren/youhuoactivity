<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title>公益上海-任务详情</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link rel="stylesheet" type="text/css" href="../wap/css/index.css"/>
    <link rel="stylesheet" type="text/css" href="../wap/css/calendar_dan.css" />
    <link rel="stylesheet" type="text/css" href="../post/css/job_list.css"/>
    <link rel="stylesheet" type="text/css" href="../post/css/job_content.css"/>
    <link rel="stylesheet" type="text/css" href="../wap/css/dropload.css"/>
    <link rel="stylesheet" type="text/css" href="css/task_content_sub.css"/>
</head>
<body style="background: #F2F2F2">
<div class="warp">
    <!--头部开始-->
    <div class="warp_zy_j">
        <a href="javascript:history.go(-1);"></a>
        <span>任务详情</span>
    </div>
    <!--头部结束-->
    <form id='form1'>
        <ul class="warp_pws_c">
            <li>
                <div class="title">
                    <b id="name"></b>
                    <div class="labelWrap"></div>
                    <i id="content"></i>
                </div>
            </li>
            <li class="content" id="subContent" style="display:none">
                <div class="subContent"></div><!--子任务内容-->
            </li>
            <li class="content">
                <ul>
                    <li>
                        <p>
                            服务时间：<i id="times"></i>
                        </p>
                    </li>
                    <li style="width: 100%;">
                        <p>
                            服务地点：<i id="address"></i>
                        </p>
                    </li>
                    <li style="">
                        <p>完成任务可获得最大志愿服务时长：<i><font style="color:#72b81e;font-weight:bold" id="serviceTime">0</font>小时</i></p>
                    </li>
                    <li style="">
                        <p>本次任务已报<font id="needNum" style="color:#72b81e;font-weight:bold"></font>人/需<font id="allNeed" style="color:#72b81e;font-weight:bold"></font>人</p>
                    </li>
                </ul>
            </li>
            <li class="content">
                <ul>
                    <li>
                        <p>
                            咨询人：<i id="consultantName"></i><span id="consultantMobile" style="color:#72b81e;font-weight:bold;padding-left:.2rem;"></span>
                        </p>
                    </li>
                    <li>
                        <p>
                            管理员：<i id="managerName"></i><span id="managerMobile" style="color:#72b81e;font-weight:bold;padding-left:.2rem;"></span>
                        </p>
                    </li>
                    <li class="applyType">
                        <p>报名条件：<i id="applyType"></i></p><p style="display:block;width:100%;"><span style="opacity:0;">报名条件：</span><i></i><span style="padding-left:.2rem;color:#999;"></span></p>
                    </li>
                    <li style="">
                        <p>完成任务后赠送<i id="serverTimes"><font id="point" style="color:#72b81e;font-weight:bold"></font>积分</i></p>
                    </li>
                    <li>
                        <p>
                            志愿服务保障：<i id="welfare"></i>
                        </p>
                    </li>
                </ul>
            </li>
            <!--<li class="content">-->
                <!--<ul>-->
                    <!--<li>-->
                        <!--<p style="width: 100%">-->
                            <!--每次招募志愿者<c id="needNum">0</c>人-->
                        <!--</p>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<p>咨询人：</p><p id="contactName"></p><c id="contactTel"></c>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<p>现场管理员：</p><p id="fieldAdminName"></p><c id="fieldAdmin"></c>-->
                    <!--</li>-->
                <!--</ul>-->
            <!--</li>-->

            <!--<li class="content">-->
                <!--<ul>-->
                    <!--<li>-->
                        <!--<p style="width: 100%">-->
                            <!--每人每次赠送<c id="point"></c>积分-->
                        <!--</p>-->
                    <!--</li>-->
                    <!--<li>-->
                        <!--<p>-->
                            <!--志愿服务保障：<i id="welfare"></i>-->
                        <!--</p>-->
                    <!--</li>-->
                <!--</ul>-->
            <!--</li>-->
            <li class="img-li">
                <p>发布方</p>
                <img id="orgLogo" src="../wap/huangye/images/hylist3.png">
                <span id="orgName"></span>
            </li>
            <li class="img-li img-list-li" style="display:none">
                <p>所属主题活动</p>
                <img src="../wap/img/pws_37.jpg">
                <span>
                <i style="color: #000000">公益嘉年华</i>
                <i>2019/11/26-2019/11/27</i>
                </span>
            </li>
            <li class="img-li img-big-li" style="display:none">
                <p>所属专题项目</p>
                <img src="../wap/img/pws_37.jpg">
                <span>1111</span>
            </li>
        </ul>

        <div class="ht70"></div>
        <footer class="warp_pws_m_sw applyFooter" style="display:none;">
            <div class="select-time" id="remove_class" style="background: #FFFFFF">
                <input type="button" value="我要报名" id="btn" style="background: red;" onclick="applyJudge()">
                <!--<span class="time leavetime"></span>&lt;!&ndash;结束时间&ndash;&gt;-->
                <!--<input id="endDate" type="text" class="input-leave none" readonly="readonly" style="display: none;">-->
                <!--<span class="time entertime"></span>&lt;!&ndash;开始时间&ndash;&gt;-->
                <!--<input id="startDate" type="text" class="input-enter none" readonly="readonly" style="display: none;">-->
            </div>
        </footer>

    </form>
</div>
<div id="date_div" class="date_div">
    <div class="warp_zy_j" style="background: #F2F2F2;">
        <a href="javascript:void(0)" onclick="closeDiv('date_div');"></a>
        <span>我要报名</span>
    </div>
</div>
<div id="user_div" class="user_div">
    <div class="warp_zy_j" style="background: #F2F2F2;">
        <a href="javascript:void(0)" onclick="closeDiv('user_div');"></a>
        <span>选择团队成员</span>
    </div>
    <div class="screenButList" style="margin: 0px;padding: 2% 0px;">
        <input type="search" class="search_input" id="name_input" placeholder="请输入姓名或手机号进行查询">
        <input type="button" class="search_button" value="" onclick="queryMembersForVerify(0,20);">
    </div>
    <div class="user-list">
        <ul class="user-list-ul">
        </ul>
    </div>
    <footer class="warp_pws_m_sw">
        <ul class="warp_pws_hd">
            <li style="width: 50%">
                <input type="button" id="selectAll" value="全选" onclick='selectAll(this)'>
            </li>
            <li style="width: 50%">
                <input type="button" id="nextStep" value="下一步（0）" onclick="openDiv_();">
            </li>
        </ul>
    </footer>
</div>
<div id="question_div" class="question_div" style="display:none;">
    <div class="warp_zy_j" style="background: #F2F2F2;">
        <a href="javascript:void(0)" onclick="closeDiv('question_div');"></a>
        <span>调查问卷</span>
    </div>
    <!--<div style="overflow: hidden;padding: 2% 4%;;border-bottom: 1px solid #E6E6E6;background: #FFD46C;">
        <span style="font-size: 13px;color: #D07500;line-height: 16px;padding: 0 0 0 20px;background: url(../wap/img/pws_210.png) no-repeat left center;background-size:13px;">
            调查问卷需要在15分钟之内全部完成，提交成功。否则要返回上一层重新选择日期。
        </span>
    </div>-->
    <ul class="question_ul" style="margin-bottom: 100px;">
        <!--<li class='question'>-->
            <!--"+val.title+"\-->
        <!--</li>-->
        <!--<li class='answer "+option.questionId+"' onclick='selectOption(this)' data-id='"+option.questionId+"' data-seq='"+option.seq+"'>-->
            <!--"+option.content+"<div class='"+option.questionId+"_answer' id='"+option.id+"'></div>-->
        <!--</li>-->
    </ul>
    <footer class="warp_pws_m_sw">
        <input type="button" value="提交" onclick="applyQuestion()">
    </footer>
</div>

<script type="text/javascript" src="../wap/js/jquery.js"></script>
<script type="text/javascript" src="../wap/js/config.js"></script>
<script type="text/javascript" src="../wap/js/jquery.spinner.js"></script>
<script type="text/javascript" src="../wap/js/jquery.cookie.js"></script>
<script type="text/javascript" src="../wap/Layer.m/layer.js"></script>
<script type="text/javascript" src="../wap/js/public.js"></script>
<!--<script type="text/javascript" src="../wap/js/user/user.js"></script>-->
<script type="text/javascript" src="../wap/js/common.js"></script>
<script type="text/javascript" src="../wap/js/dropload.min.js"></script>

<script type="text/javascript">
    function queryMembersForVerify(pageNumber, pageSize, type){
        $(".user-list-ul").html("");
        $('.user-list').dropload({
            scrollArea: window,
            loadDownFn: function (me) {
                $(".dropload-down").remove();
                pageNumber++;
                var data = {"prjvOrgId": prjvorgMsg.prjvOrgId, "pageSize": pageSize, "pageNumber": pageNumber};
                var searchContent = $("#name_input").val();
                if (searchContent) {
                    data.searchContent = searchContent;
                }
                $.ajax({
                    xhrFields: {
                        withCredentials: true
                    },
                    type: 'post',
                    url: base_url + "/html5/v1/orgPlace/queryMembersForVerify",
                    data: JSON.stringify(data),
                    dataType: 'json',
                    headers: {'token': token},
                    contentType: "application/json;charset=utf-8",
                    success: function (data) {
                        if (data.code == 0) {
                            var dayList = data.data.records;
                            var html = "";
                            selectAllNum = data.data.total;
                            $("#selectAll").val("全选（"+selectAllNum+"）");
                            if(dayList.length>0) {
                                $.each(dayList, function (k, val) {
                                    var photo = "../wap/img/none.png";
                                    if (val.elePhoto) {
                                        photo = val.elePhoto;
                                    }
                                    html += '<li onclick="selectPhoto(\'' + val.prjvUserId + '\')">\
                                                <div>\
                                                    <img class="photo" src="' + photo + '">\
                                                    <i id="' + val.prjvUserId + '" data-headImg="' + photo + '" data-mobile="' + val.mobile + '" data-nickName="' + val.realName + '" class="mect_sc"></i>\
                                                    ' + val.realName + '\
                                                </div>\
                                        </li>';
                                })
                                $(".user-list-ul").append(html);
                                me.resetload();
                            }else{
                                $(".noneLi").hide();
                                $(".user-list-ul").append(
                                    "<li class='noneLi' style='background: #F2F2F2;width: 100%;'>\
                                        <a href='javascript:void(0)'>\
                                        <h3 style='text-align: center;'>已经没有更多啦。。。</h3>\
                                        </a>\
                                    </li>");
                                me.lock();
                                me.noData();//无数据重置
                                me.resetload();
                            }
                        }else{
                            layer.open({
                                content: resp.msg
                                ,skin: 'msg'
                                ,time: 1
                            });
                            me.lock();
                            me.noData();
                        }
                    },
                    error:function(e){
                        layer.open({
                            content: '获取失败'
                            ,skin: 'msg'
                            ,time: 1
                        });
                        me.lock();
                        me.noData();//无数据重置
                        me.resetload();
                    }
                })
            }
        })
        if(type==0){
            var data = {"prjvOrgId": prjvorgMsg.prjvOrgId, "pageSize": pageSize, "pageNumber": pageNumber};
            var searchContent = $("#name_input").val();
            if (searchContent) {
                data.searchContent = searchContent;
            }
            $.ajax({
                xhrFields: {
                    withCredentials: true
                },
                type: 'post',
                url: base_url + "/html5/v1/orgPlace/queryMembersForVerify",
                data: JSON.stringify(data),
                dataType: 'json',
                headers: {'token': token},
                contentType: "application/json;charset=utf-8",
                success: function (data) {
                    if (data.code == 0) {
                        var dayList = data.data.records;
                        selectAllNum = data.data.total;
                        $("#selectAll").val("全选（"+selectAllNum+"）");
                        var html = "";
                        if(dayList.length>0) {
                            $.each(dayList, function (k, val) {
                                var photo = "../wap/img/none.png";
                                if (val.elePhoto) {
                                    photo = val.elePhoto;
                                }
                                html += '<li onclick="selectPhoto(\'' + val.prjvUserId + '\')">\
                                                <div>\
                                                    <img class="photo" src="' + photo + '">\
                                                    <i id="' + val.prjvUserId + '" data-headImg="' + val.headUrl + '" data-mobile="' + val.mobile + '" data-nickName="' + val.realName + '" class="mect_sc"></i>\
                                                    ' + val.realName + '\
                                                </div>\
                                        </li>';
                            })
                            $(".user-list-ul").html(html);
                        }else{
                            $(".noneLi").hide();
                            $(".user-list-ul").append(
                                "<li class='noneLi' style='background: #F2F2F2;width: 100%;'>\
                                    <a href='javascript:void(0)'>\
                                    <h3 style='text-align: center;'>已经没有更多啦。。。</h3>\
                                    </a>\
                                </li>");
                        }
                    }else{
                        layer.open({
                            content: resp.msg
                            ,skin: 'msg'
                            ,time: 1
                        });
                    }
                },
                error:function(e){
                    layer.open({
                        content: '获取失败'
                        ,skin: 'msg'
                        ,time: 1
                    });
                }
            })
        }
    }
    if($.cookie('user_msg')!==undefined||$.cookie('token')!==undefined){
        var head = document.getElementsByTagName('head')[0];
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = '../wap/js/user/user.js';
        head.appendChild(script);
    }

    // if($.cookie('user_msg')==undefined||$.cookie('token')==undefined){
    //     var un = $.cookie("un");//是否实名
    //     var content = '请登陆后再进行操作';
    //     if(un==null || un==undefined || un=="") {
    //         content = '请实名后再进行操作';
    //     }
    //     setTimeout(function(){
    //         window.location.href=history.back()
    //     },500)
    //
    //     // $('#btn').removeAttr('onclick');
    //     // $('#btn').on('click', null, function(){
    //     //     layer.open({
    //     //         content: content
    //     //         , btn: ['确定', '取消']
    //     //         , yes: function (index) {
    //     //             //$(location).attr('href', "../cert/cert_index.html");
    //     //             jumpBank('web/srcb/index?channel=P9a4c8c66b1c74b53b881a5f337745a84&name=&idCard=&phone=');
    //     //         }
    //     //         , no: function (index) {
    //     //             return;
    //     //         }
    //     //     });
    //     // })
    // }
    // if(localStorage.getItem('prjvorgMsg')==undefined||localStorage.getItem('prjvorgMsg')==""){
    //     alert('暂无权限或登录过期');
    //     window.location.href = '../login/login.html';
    // }
    var type = $.getUrlParam("type"),
        pkPostCode = $.getUrlParam("pkPostCode"),
        mainCode=$.getUrlParam('type'),
        reqAttendTimes = 0,
        selectAllNum = 0,
        selectNum = 0,
        hasQuestion = 0,
        hasQuestionNull = 0;
    // var prjvorgMsg = JSON.parse(localStorage.getItem('prjvorgMsg'));
    var groupType = $.getUrlParam("groupType");

    if(groupType==1){
        var head = document.getElementsByTagName('head')[0];
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.src = '../wap/js/prjvorg/prjvorg.js';
        head.appendChild(script);

        $(".applyFooter").show();
        $("#btn").val("团体报名");
        $('#btn').attr("onclick","openDiv('user_div')");
        // queryMembersForVerify(0,20,1);
    }else if(groupType==3){
        $('#btn').hide();
    }else if(groupType==2){
        $(".applyFooter").show();
        $("#btn").val("我要报名");
        // $('#btn').attr("onclick","apply()");
    }
    // if(type=="group"){
    //     if(localStorage.getItem('prjvorgMsg')==undefined||localStorage.getItem('prjvorgMsg')==""){
    //         alert('暂无权限或登录过期');
    //         window.location.href = '../login/login.html';
    //     }
    //     prjvorgMsg = JSON.parse(localStorage.getItem('prjvorgMsg'));
    //     $("#btn").val("团体报名");
    //     $('#btn').attr("onclick","openDiv('user_div')");
    //     queryMembersForVerify(0,20,0);
    //     var groupType = $.getUrlParam("groupType");
    //     if(groupType==1){
    //         $(".warp").show(); // 问题显示
    //         $(".question_div").hide();
    //     }
    // }

</script>
<script type="text/javascript" src="js/task_date_dan_content.js"></script>
<script type="text/javascript" src="js/task_content_sub.js"></script>
</body>
</html>

