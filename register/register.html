<!DOCTYPE html>
<html>

<head lang="en">
    <meta charset="UTF-8">
    <title>公益上海</title>
    <meta name="viewport" content="width=device-width,initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta content="yes" name="apple-mobile-web-app-capable">
    <meta content="black" name="apple-mobile-web-app-status-bar-style">
    <meta content="telephone=no" name="format-detection">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <meta http-equiv="Refresh" content="0; url=https://h5.shcvs.cn/gysh/web/srcb/index?channel=P9a4c8c66b1c74b53b881a5f337745a84&name=&idCard=&phone=&userNo="/>
    <link rel="stylesheet" type="text/css" href="../wap/css/index.css" />
    <style type="text/css">
    #btnSend{width: 100px;height: 36px;border: 0;border-radius: 5px;background: #999999;font-size: 15px;color: #FFFFFF;position: absolute;right: 5px;top: 3px;}
    </style>
</head>

<body style="background: #FFFFFF">
    <div class="warp">
        <img src="../wap/img/pws_37.jpg">
        <div class="warp_pws_r">
            <ul class="warp_pws_r_sp">
                <li>
                    <img src="../wap/img/pws_38.jpg">
                    <input type="text" placeholder="输入11位手机号" class="warp_pws_r_so" name="mobile">
                </li>
                <li>
                    <img src="../wap/img/pws_41.jpg">
                    <input type="password" placeholder="输入6-12位数字、字母密码" class="warp_pws_r_so" name="userPassword">
                </li>
                <li>
                    <img src="../wap/img/pws_41.jpg">
                    <input type="password" placeholder="请再次输入密码" class="warp_pws_r_so" name="repeatuserPassword">
                </li>
                <li>
                    <img src="../wap/img/pws_39.jpg">
                    <input type="text" placeholder="输入6位验证码" class="warp_pws_r_so" name="code">
                    <input id="btnSendCode" type="button" value="获取验证码" onClick="sendMessage()" />
                </li>
            </ul>
            <style>
                .yhxy{
                    display: block;
                    width: 100%;
                    overflow: hidden;
                    padding: 0.2rem 0 0 0;
                }
                .yhxy i{
                    display: block;
                    width: 16px;
                    height: 16px;
                    float: left;
                }
                .yhxy i img{
                    display: none;
                }
                .yhxy .choice img{
                    display: block;
                }
                .yhxy span{
                    display: block;
                    float: left;
                    margin-left: 0.2rem;
                }
                .mb{
                    width: 100%;
                    height: 100%;
                    z-index: 90;
                    position: fixed;
                    left: 0;
                    top: 0;
                    background: rgba(0,0,0,0.5);
                    display: none;
                }
                .sytk{
                    width: 90%;
                    height: 460px;
                    position: fixed;
                    left: 5%;
                    top: 8%;
                    background: #fff;
                    border-radius: 1px;
                    box-shadow: 0 0 8px #ddd;
                    z-index: 99;
                    display: none;
                }
                .sytk h1{
                    display: block;
                    width: 100%;
                    overflow: hidden;
                    line-height: 56px;
                    text-align: center;
                    font-size: 18px;
                }
                .sytk_con{
                    display: block;
                    width: 94%;
                    height: 344px;
                    margin: 0 auto;
                    font-size: 14px;
                    line-height: 20px;
                    overflow-y: auto;
                    overflow-x: hidden;
                }
                .sytk_b{
                    display: block;
                    width: 100%;
                    overflow: hidden;
                    margin-top: 10px;
                }
                .sytk_b a{
                    display: block;
                    float: left;
                    text-align: center;
                    width: 50%;
                    line-height: 46px;
                    font-size: 16px;
                    color: #343434;
                    border-top: 1px solid #E6E6E6;
                }
                .sytk_b a:first-child{
                    margin-left: -1px;
                    border-right: 1px solid #E6E6E6;
                }
            </style>
            <div class="yhxy">
                <i style="background: url(../wap/img/pws_276.png) no-repeat center;background-size: 100% 100%;" class="choice">
                    <img src="../wap/img/pws_276_on.png">
                    <input type="checkbox" checked style="display: none" name="choiced">
                </i>
                <span>
                    我已阅读《使用条款》
                </span>
            </div>
            <input type="button" value="注册" class="warp_pws_r_si" onclick="register()">
            <div class="warp_pws_r_su">
                <a id="loginA" href="../login/login.html" style="float: right">已有账号？<i>去登录</i></a>
            </div>
        </div>
    </div>
    <div class="mb"></div>
    <div class="sytk">
        <h1>
            使用条款
        </h1>
        <div class="sytk_con">
            <p>
                条款内容：公益护照是全方位记录公益行为的载体，能够记录您的慈善捐赠、志愿服务、公益荣誉等信息，<br>
				所记录的信息是您在公益活动评比表彰、享受支持保障时的重要依据，也是您升学就职所需志愿服务时间的有效证明。<br>
				在线申领电子公益护照，电子护照生成后可申请纸质公益护照。使用公益护照、记录公益轨迹、享受公益保障，开启公益生活新方式！<br>
				（注：公益护照持有人享有上海市公益服务促进中心提供的涵盖人身意外、意外医疗、<br>
				第三者责任险等7项年度保额高达1,500000元的公益活动保险保障。每次参加公益活动时需点击签到，当意外发生，可轻松申请在线保险理赔。）
			</p>
        </div>
        <div class="sytk_b">
            <a href="#" class="agree">
                同意
            </a>
            <a href="#" class="unagree">
                不同意
            </a>
        </div>
    </div>
</body>

</html>
<script type="text/javascript" src="../wap/js/jquery.js"></script>
<script type="text/javascript" src="../wap/js/config.js"></script>
<script type="text/javascript" src="../wap/js/common.js"></script>
<script type="text/javascript" src="../wap/js/jquery.cookie.js"></script>
<script type="text/javascript" src="../wap/js/web-storage-cache.js"></script>
<script type="text/javascript" src="../wap/js/regular.js"></script>
<script type="text/javascript" src="../wap/Layer.m/layer.js"></script>
<script type="text/javascript" src="../wap/js/public.js"></script>
<script language="javascript" type="text/javascript">
    // 以下方式直接跳转
    window.location.href='https://h5.shcvs.cn/gysh/web/srcb/index?channel=P9a4c8c66b1c74b53b881a5f337745a84&name=&idCard=&phone=&userNo=';
</script>
<!--使用条款-->
<script>
    var jumpAdd = $.getUrlParam("jumpAdd"), hrefA="../login/login.html";
    if(jumpAdd){
        hrefA = "../login/login.html?jumpAdd="+jumpAdd;
        $("#loginA").attr("href", hrefA);
    }
    $(".yhxy i").click(function(){
        var cla=$(this).attr("class")
        if(cla=="choice"){
            $(this).find("input").prop("checked",false);
            $(this).removeClass("choice")
        }else{
            $(this).find("input").prop("checked",true);
            $(this).addClass("choice")
        }
    })
    $(".yhxy span").click(function(){
        $(".sytk").show()
    })
    $(".agree").click(function(){
        $(".yhxy i").find("input").prop("checked",true);
        $(".yhxy i").addClass("choice")
        $(".sytk").hide()
        $(".mb").hide()
        console.log($(".yhxy i input").attr("checked"))
    })
    $(".unagree").click(function(){
        $(".yhxy i").find("input").prop("checked",false);
        $(".yhxy i").removeClass("choice")
        $(".sytk").hide()
        $(".mb").hide()
        console.log($(".yhxy i input").attr("checked"))
    })
</script>
<script type="text/javascript">

    //验证信息
    function register(){
        var mobile = $.trim($("input[name='mobile']").val());
        var userPassword = $.trim($("input[name='userPassword']").val());
        var repeatuserPassword = $.trim($("input[name='repeatuserPassword']").val());
        var choiced= $.trim($("input[name='choiced']").attr("checked"));
        var code = $.trim($("input[name='code']").val());
        if(!regular_tel(mobile)){
            return false;
        };
        if(!only_mobile(mobile)){
            layer.open({
                content: '用户已注册',
                skin: 'msg',
                time: 2 //2秒后自动关闭
            });
            return false;
        }
        if(!regular_pwd(userPassword)){
            return false;
        }
        if(choiced != "checked"){
            layer.open({
                content: '请仔细阅读使用条款'
                ,skin: 'msg'
                ,time: 1 //2秒后自动关闭
            });
            return false;
        }
        if(!regular_code(code)){
            return false;
        }
        if(userPassword==repeatuserPassword && userPassword!=""){
            $.ajax({
                xhrFields: {
                    withCredentials: true
                },
                type: "post",
                url: base_url + "html5/v1/user/quickReg",
                data: JSON.stringify({
                    "smsCode": code,
                    "userLoginMobile": mobile,
                    "userPassword": userPassword
                }),
                dataType: 'json',
                contentType: "application/json;charset=utf-8",
                success: function(data) {
                    if (data.code==0) {
                        layer.open({
                            content: '注册成功'
                            ,skin: 'msg'
                            ,time: 1 //2秒后自动关闭
                        });
                        $.cookie('reg_mobile',null);
                        setTimeout(function(){window.location.href=hrefA;},1000);
                    }else{
                        layer.open({
                            content: data.msg
                            ,skin: 'msg'
                            ,time: 1 //2秒后自动关闭
                        });
                        return false;
                    }
                },
                error: function(e) {
                    layer.open({
                        content: '提交错误',
                        skin: 'msg',
                        time: 1 //2秒后自动关闭
                    });
                    return false;
                }
            })
            return true;
        }else{
            layer.open({
                content: '两次密码输入不一致',
                skin: 'msg',
                time: 2 //2秒后自动关闭
            });
            return false;
        }
    }
</script>
<script type="text/javascript">
    var InterValObj; //timer变量，控制时间
    var count = 30; //间隔函数，1秒执行
    var curCount;//当前剩余秒数
    function sendMessage() {
        var mobile = $.trim($("input[name='mobile']").val());
        var userPassword = $.trim($("input[name='userPassword']").val());
        var repeatuserPassword = $.trim($("input[name='repeatuserPassword']").val());
        if(!regular_tel(mobile)){
            return false;
        };
        if(!only_mobile(mobile)){
            layer.open({
                content: '用户已注册',
                skin: 'msg',
                time: 2 //2秒后自动关闭
            });
            return false;
        }
        if(!regular_pwd(userPassword)){
            return false;
        }
        if(userPassword==repeatuserPassword && userPassword!=""){
            curCount = count;
            var dealType; //验证方式
            var uid = $("#uid").val();//用户uid
            if ($("#phone").attr("checked") == true) {
                dealType = "phone";
            }
            else {
                dealType = "email";
            }

            //设置button效果，开始计时
            ajax_code(mobile);
            $("#btnSendCode").attr("disabled", "true");
            $("#btnSendCode").val( + curCount + "秒再获取");
            InterValObj = window.setInterval(SetRemainTime, 1000); //启动计时器，1秒执行一次
        }else{
            layer.open({
                content: '两次密码输入不一致',
                skin: 'msg',
                time: 2 //2秒后自动关闭
            });
            return false;
        }
    }
    //timer处理函数
    function SetRemainTime() {
        if (curCount == 0) {
            window.clearInterval(InterValObj);//停止计时器
            $("#btnSendCode").removeAttr("disabled");//启用按钮
            $("#btnSendCode").val("重新发送");
        }
        else {
            curCount--;
            $("#btnSendCode").val( + curCount + "秒再获取");
        }
    }
    // 验证手机唯一
    function only_mobile(mobile){
        var str = false;
        $.ajax({
            xhrFields: {
               withCredentials: true
            },
            type:'post',
            url :base_url + "html5/v1/user/checkMobileExists",
            data:JSON.stringify({'userLoginMobile':mobile}),
            dataType:'json',
            contentType: "application/json;charset=utf-8",
            async: false,
            success:function(data){
                if(data.code==0){
                    str = true;
                }else{
                    return str;
                }
            },
            error:function(e){
                layer.open({
                    content: '获取失败',
                    skin: 'msg',
                    time: 2 //2秒后自动关闭
                    });
                return str;
            }
        })
        return str;
    }
    function ajax_code(mobile){
        var str = false;
        $.ajax({
            xhrFields: {
               withCredentials: true
            },
            type:'post',
            url :base_url + "html5/v1/sms/sendSms",
            data:JSON.stringify({"mobile":mobile,"signName":'公益上海'}),
            dataType:'json',
            contentType: "application/json;charset=utf-8",
            success:function(data){
                if(data.code == 0){
                    str = true;
                    layer.open({
                        content: data.msg
                        ,skin: 'msg'
                        ,time: 2 //2秒后自动关闭
                    });
                    return str;
                }else if(data.code == -1){
                    $("#btnSendCode").attr('id','btnSend')
                    $("#btnSend").attr("disabled","disabled");
                    $("#btnSend").val("获取验证码");
                    layer.open({
                        content: data.msg
                        ,skin: 'msg'
                        ,time: 2 //2秒后自动关闭
                    });
                    return str; 
                }
            },
            error:function(e){
                layer.open({
                    content: '短信发送失败'
                    ,btn: '确定'
                });
                return str;
            }
        })
        return str;
    }
    //15124681486
    //450842
    function ajax_check_code(){
        var str1 = false;
        var mobile = $.trim($("input[name='mobile']").val());
        var code = $.trim($("input[name='code']").val());
        if(!regular_code(code)){
            return false;
        }
        $.ajax({
            type:'post',
            url :base_url + "html5/v1/sms/verifyCode",
            data:JSON.stringify({'mobile':mobile,'code':code}),
            dataType:'json',
            contentType: "application/json;charset=utf-8",
            async: false,
            success:function(data){
                if(data.code==0){
                    if(data.data.status){
                        str1 = true;
                    }else{
                        layer.open({
                            content: '验证码不正确',
                            skin: 'msg',
                            time: 2 //2秒后自动关闭
                        });
                        return str1;    
                    }
                }else{
                    layer.open({
                        content: '验证码不正确',
                        skin: 'msg',
                        time: 2 //2秒后自动关闭
                    });     
                    return str1;
                }
                
            },
            error:function(e){
                layer.open({
                        content: '验证失败'
                        ,skin: 'msg'
                        ,time: 2 //2秒后自动关闭
                    });
                return str1;
            }
        })
        return str1;
    }
</script>


